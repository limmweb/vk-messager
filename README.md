
 # Автоматизация общения в ВКонтакте с помощью ИИ-агента

 Этот Python-скрипт — полноценный ИИ-агент для автоматизации общения в личных сообщениях ВКонтакте. Он использует **VK API** для взаимодействия с платформой ВКонтакте, **OpenAI** для генерации текстовых ответов и сохраняет данные в **JSON** и **Excel** для аналитики. Программа поддерживает как личные аккаунты, так и группы, обеспечивая гибкость в использовании.

 ## Преимущества и возможности программы

 ### Полноценный ИИ-агент для автоматизации общения
 - **Автоматизация текстовых сообщений**: Программа полностью автоматизирует переписку в личных сообщениях ВКонтакте, используя модель `gpt-4o-mini` от OpenAI для генерации естественных и контекстно-уместных ответов.
 - **Поддержка различных сценариев**:
   - **Консультации**: Идеально подходит для автоматизации клиентской поддержки, ответа на часто задаваемые вопросы и предоставления информации о продуктах/услугах.
   - **Продажи**: Может вести диалог с потенциальными клиентами, презентовать товары или услуги, обрабатывать возражения и направлять к покупке.
   - **Межличностный контакт**: Способна поддерживать дружескую переписку, проявлять интерес к собеседнику и выстраивать эмоциональную связь.
 - **Идея автора — помощник в дейтинге**:
   - Программа изначально разрабатывалась как помощник для автоматизации общения в сфере знакомств. Она может переписываться с девушками или парнями от вашего имени, вызывать интерес, поддерживать диалог и даже выводить на свидания. Вы задаете свою личность, правила общения и цели (например, "вызвать интерес и договориться о встрече"), а ИИ-агент делает остальное.

 ### Гибкость и кастомизация
 - **Настраиваемая личность**: Вы можете задать, кем будет представляться ИИ (например, "дружелюбный предприниматель", "романтичный парень" или "заботливая девушка").
 - **Коммерческая информация**: Укажите данные о вашем бизнесе, товарах или услугах, которые ИИ будет использовать в диалогах.
 - **Правила и цели общения**: Определите стиль общения (формальный, дружелюбный, флиртующий) и цели диалога (продажа, консультация, знакомство).
 - **Кастомизация промпта**: Вы можете изменить системный промпт для OpenAI, чтобы адаптировать поведение ИИ под ваши нужды (подробности ниже).

 ### Аналитика и мониторинг
 - **Досье на собеседников**: Программа собирает информацию о собеседниках (интересы, город, статус и т.д.) через VK API и сохраняет её в JSON-файлы в папке `Dossier`.
 - **Отчёты в Excel**: Все отправленные сообщения логируются в файл `reports.xlsx` с указанием времени, отправителя, получателя, текста сообщения, а также токенов и их стоимости.
 - **Учет токенов OpenAI**: Скрипт отслеживает количество использованных токенов и их стоимость, записывая данные как в сессионный файл, так и в досье.

 ### Удобство использования
 - **Сессионная механика**: Программа поддерживает работу с несколькими сессиями (для разных аккаунтов или групп), которые хранятся в папке `Sessions` в формате `.ini`. Вы можете легко переключаться между сессиями или создавать новые.
 - **Имитация активности**: Скрипт имитирует набор текста и устанавливает статус "онлайн", чтобы переписка выглядела естественной.
 - **Обработка ошибок**: Включает механизмы повторных попыток при сбоях VK API или OpenAI, что делает программу устойчивой к временным проблемам с сетью.

 ### Потенциал для разных задач
 - **Для бизнеса**: Автоматизируйте общение с клиентами, увеличивая продажи и экономя время.
 - **Для знакомств**: Позвольте ИИ вести переписку от вашего имени, чтобы находить подходящих людей и договариваться о встречах.
 - **Для общения**: Поддерживайте диалоги с друзьями или знакомыми, если у вас нет времени на переписку.

 ## Требования

 ### Системные требования
 - **Python**: Версия 3.8 или выше.
 - **pip**: Менеджер пакетов Python для установки зависимостей.

 ### Зависимости
 Установите необходимые библиотеки с помощью команды:
 ```bash
 pip install vk_api openai requests openpyxl
 ```

 Полный список зависимостей:
 - `vk_api` – для работы с VK API.
 - `openai` – для генерации текстов через OpenAI API.
 - `requests` – для HTTP-запросов.
 - `openpyxl` – для записи отчётов в Excel.
 - Встроенные модули Python: `os`, `json`, `unicodedata`, `configparser`, `re`, `datetime`, `time`, `threading`.

 ## Настройка окружения

 ### 1. Получение токена ВКонтакте
 Для работы с личными сообщениями ВКонтакте необходимо получить токен с соответствующими правами через приложение **Kate Mobile**.

 - **Получение токена через Kate Mobile**:
   - Используйте следующую ссылку для авторизации: [Получить токен ВКонтакте](https://id.vk.com/auth?return_auth_hash=11e9a6ff516853c86f&redirect_uri=https%3A%2F%2Foauth.vk.com%2Fblank.html&redirect_uri_hash=a0f0b14f8eedcafbe2&force_hash=1&app_id=2685278&response_type=token&code_challenge=&code_challenge_method=&scope=1040183263&state=)
   - **Важно**: Открывайте ссылку в браузере на компьютере (например, Chrome, Firefox). **Не используйте мобильное приложение ВКонтакте**, так как оно не предоставит токен с нужными правами.
   - Войдите в свой аккаунт ВКонтакте, разрешите доступ для приложения Kate Mobile.
   - После авторизации вы будете перенаправлены на страницу с URL вида:
     ```
     https://oauth.vk.com/blank.html#access_token=ВАШ_ТОКЕН&expires_in=0&user_id=ВАШ_ID
     ```
   - Скопируйте значение `access_token` (например, `vk1.a.To_Y114...`).
   - Этот токен предоставляет доступ к личным сообщениям, что необходимо для работы программы.

 ### 2. Получение ключа OpenAI
 - **Регистрация в OpenAI**:
   - Перейдите на [OpenAI Platform](https://platform.openai.com).
   - Нажмите «Sign Up» и создайте аккаунт, указав email, пароль и подтвердив номер телефона.
   - Если у вас уже есть аккаунт, войдите в систему.
 - **Создание API-ключа**:
   - Перейдите в раздел «API Keys» ([dashboard](https://platform.openai.com/account/api-keys)).
   - Нажмите «Create new secret key».
   - Скопируйте сгенерированный ключ (например, `sk-7oRdMZm...`).
   - **Важно**: Сохраните ключ в безопасном месте, так как он не будет отображаться повторно.

 ### 3. Установка и запуск
 - **Установите Python**:
   - Скачайте и установите Python 3.8+ с [python.org](https://www.python.org/downloads/).
   - Убедитесь, что `pip` установлен (обычно идет с Python).
   - Проверьте версии:
     ```bash
     python --version
     pip --version
     ```
 - **Установите зависимости**:
   ```bash
   pip install vk_api openai requests openpyxl
   ```
 - **Скачайте скрипт**:
   - Сохраните файл `vk_messaging_app.py` в рабочую папку.
 - **Запустите скрипт**:
   ```bash
   python vk_messaging_app.py
   ```
   - Скрипт предложит выбрать существующую сессию или создать новую.

 ## Сессионная механика

 Программа использует сессионный подход для управления настройками и данными. Сессии хранятся в папке `Sessions` в формате `.ini`-файлов.

 ### Создание новой сессии
 1. При запуске скрипта выберите опцию «создать новую сессию» (введите `0`).
 2. Укажите:
    - Ваш API-ключ VK (полученный через Kate Mobile).
    - Ваш API-ключ OpenAI.
    - Является ли сессия для группы (да/нет). Если да, укажите ID группы.
    - Вашу личность (до 1000 символов, например, "Я веселый парень, который любит путешествия").
    - Коммерческую информацию (например, "Продаю курсы по фитнесу").
    - Правила общения (например, "Будь дружелюбным, но не навязчивым").
    - Цели общения (например, "Договориться о свидании").
 3. Сессия будет сохранена в файл (например, `Sessions/Имя_Фамилия.ini` для пользователя или `Sessions/group_ID_ИмяГруппы.ini` для группы).

 ### Выбор существующей сессии
 - При запуске скрипт отобразит список доступных сессий.
 - Выберите нужную сессию, введя её номер.
 - Программа загрузит настройки и начнёт работу с этой сессией.

 ### Что хранится в сессии
 - API-ключи (VK и OpenAI).
 - Информация о личности, бизнесе, правилах и целях общения.
 - Статистика токенов OpenAI (входные, выходные, общие, стоимость).

 ## Кастомизация промпта

 Промпт для OpenAI формируется в функции `create_openai_prompt`. Вы можете настроить его, чтобы изменить поведение ИИ.

 ### Текущий промпт
 Текущий системный промпт выглядит так:
 ```python
 system_content = (
     f"{date_time_str}\n"
     "Ты переписываешься в личных сообщениях Вконтакте от Моего лица используя указанные данные и инструкции.\n"
     f"Моя Личность: \"{personality}\"\n"
     f"Коммерческая информация: \"{commercial_info}\"\n"
     f"Мой Собеседник: \"{partner_info}\" . Информация предоставлена из API метода user.get ВКонтакте . "
     "Пожалуйста расшифровывай пары \"ключ\": \"значение\" в соответствии с известной тебе документацией.\n"
     f"Инструкции общения: \"{conversation_rules}\" , Цели общения: \"{conversation_goal}\" "
 )
 ```

 ### Что можно изменить
 - **Основной текст**: Вы можете изменить формулировку, например, добавить больше контекста о вашей личности или изменить стиль общения.
   - Пример: Замените `"Ты переписываешься в личных сообщениях Вконтакте от Моего лица используя указанные данные и инструкции."` на `"Ты мой виртуальный помощник, который общается от моего имени в ВКонтакте в романтическом стиле."`.
 - **Дополнительные инструкции**: Добавьте в `system_content` новые указания, например, "Используй эмодзи в каждом сообщении" или "Не предлагай встречу, пока собеседник не проявит интерес".

 ### Что нельзя менять
 - **Переменные**: Не удаляйте и не изменяйте переменные `{date_time_str}`, `{personality}`, `{commercial_info}`, `{partner_info}`, `{conversation_rules}`, `{conversation_goal}`, так как они динамически подставляются из сессии.
 - **Структура**: Сохраните структуру промпта (системное сообщение + история диалога + финальное системное сообщение), иначе OpenAI может не понять задачу.

 ### Пример кастомизации
 Если вы хотите, чтобы ИИ общался в более романтическом стиле, измените `system_content`:
 ```python
 system_content = (
     f"{date_time_str}\n"
     "Ты мой виртуальный помощник, который общается от моего имени в ВКонтакте в романтическом и игривом стиле.\n"
     f"Моя Личность: \"{personality}\"\n"
     f"Коммерческая информация: \"{commercial_info}\"\n"
     f"Мой Собеседник: \"{partner_info}\" . Информация предоставлена из API метода user.get ВКонтакте . "
     "Пожалуйста расшифровывай пары \"ключ\": \"значение\" в соответствии с известной тебе документацией.\n"
     f"Инструкции общения: \"{conversation_rules}\" , Цели общения: \"{conversation_goal}\" \n"
     "Добавляй комплименты и легкий флирт в каждом сообщении. Используй эмодзи, чтобы сделать текст более живым. 😊"
 )
 ```

 ## Пример работы

 1. Запустите скрипт:
    ```bash
    python vk_messaging_app.py
    ```
 2. Создайте новую сессию:
    - Введите токен VK и OpenAI.
    - Укажите, что вы пользователь (не группа).
    - Личность: "Я веселый парень, который любит путешествия и знакомства."
    - Правила общения: "Будь дружелюбным, делай комплименты, предлагай встретиться после 3-4 сообщений."
    - Цели общения: "Познакомиться и договориться о свидании."
 3. Скрипт начнёт отслеживать новые сообщения в личных сообщениях.
 4. Когда кто-то напишет вам, ИИ:
    - Соберёт информацию о собеседнике (интересы, город и т.д.).
    - Сгенерирует ответ, учитывая вашу личность, правила и цели.
    - Имитирует набор текста и отправит сообщение.
 5. Проверьте:
    - Папку `Dossier` для досье на собеседников.
    - Файл `reports.xlsx` для логов сообщений.

 ## Потенциал для доработки

 Программа имеет большой потенциал для расширения функционала:
 - **Поддержка медиа**: Текущая версия не распознаёт изображения, стикеры, аудио, голосовые сообщения и другие виды медиа. Это требует доработки для более полного взаимодействия.
 - **Автоматизация добавления друзей и начала диалога**: Можно интегрировать функции поиска пользователей, добавления в друзья и инициации диалогов, чтобы ИИ мог самостоятельно находить собеседников.
 - **Интеграция в глобальные системы**: Программа может стать частью более крупной системы автоматизации ВКонтакте, например, для массового маркетинга, управления сообществами или анализа аудитории.
 - **Расширенная аналитика**: Добавление более детализированных отчётов, например, статистики по успешности диалогов (сколько диалогов привели к продажам или встречам).

 ## Устранение неполадок

 - **Ошибка аутентификации VK**:
   - Убедитесь, что токен получен через Kate Mobile и имеет доступ к личным сообщениям.
   - Проверьте, не истёк ли токен, и получите новый, если нужно.
 - **Ошибка OpenAI**:
   - Проверьте API-ключ и наличие кредитов на аккаунте OpenAI.
   - Убедитесь, что модель `gpt-4o-mini` доступна.
 - **Проблемы с подключением**:
   - Скрипт автоматически пытается переподключиться при сбоях сети. Если проблема сохраняется, проверьте интернет-соединение.
 - **Сообщения не отправляются**:
   - Проверьте, не заблокирован ли собеседник.
   - Убедитесь, что у вас есть права на отправку сообщений (например, в чатах группы).

 ## Лицензия

 Этот проект распространяется под лицензией MIT. Вы можете использовать, изменять и распространять код, сохраняя уведомление об авторстве.

 ---

 Если у вас есть вопросы или предложения, создайте issue в репозитории или свяжитесь с автором.
